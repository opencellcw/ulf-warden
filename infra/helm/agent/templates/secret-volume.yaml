{{- if .Values.secretManager.enabled }}
# SecretProviderClass for Google Secret Manager
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: {{ include "agent.fullname" . }}-secrets
  namespace: {{ .Release.Namespace }}
spec:
  provider: gcp
  parameters:
    secrets: |
      - resourceName: "projects/{{ .Values.secretManager.projectID }}/secrets/anthropic-api-key/versions/latest"
        path: "anthropic-api-key"
      {{- if .Values.agent.channel.slack.enabled }}
      - resourceName: "projects/{{ .Values.secretManager.projectID }}/secrets/slack-bot-token/versions/latest"
        path: "slack-bot-token"
      - resourceName: "projects/{{ .Values.secretManager.projectID }}/secrets/slack-app-token/versions/latest"
        path: "slack-app-token"
      - resourceName: "projects/{{ .Values.secretManager.projectID }}/secrets/slack-signing-secret/versions/latest"
        path: "slack-signing-secret"
      {{- end }}
      {{- if .Values.agent.channel.discord.enabled }}
      - resourceName: "projects/{{ .Values.secretManager.projectID }}/secrets/discord-bot-token/versions/latest"
        path: "discord-bot-token"
      - resourceName: "projects/{{ .Values.secretManager.projectID }}/secrets/discord-admin-user-ids/versions/latest"
        path: "discord-admin-user-ids"
      {{- end }}
      {{- if .Values.agent.channel.telegram.enabled }}
      - resourceName: "projects/{{ .Values.secretManager.projectID }}/secrets/telegram-bot-token/versions/latest"
        path: "telegram-bot-token"
      {{- end }}
  secretObjects:
  - secretName: {{ include "agent.fullname" . }}-secrets
    type: Opaque
    data:
    - objectName: "anthropic-api-key"
      key: "anthropic-api-key"
    {{- if .Values.agent.channel.slack.enabled }}
    - objectName: "slack-bot-token"
      key: "slack-bot-token"
    - objectName: "slack-app-token"
      key: "slack-app-token"
    - objectName: "slack-signing-secret"
      key: "slack-signing-secret"
    {{- end }}
    {{- if .Values.agent.channel.discord.enabled }}
    - objectName: "discord-bot-token"
      key: "discord-bot-token"
    - objectName: "discord-admin-user-ids"
      key: "discord-admin-user-ids"
    {{- end }}
    {{- if .Values.agent.channel.telegram.enabled }}
    - objectName: "telegram-bot-token"
      key: "telegram-bot-token"
    {{- end }}
{{- end }}
